<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каклог - трекер пищеварения</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Каклог - приложение для отслеживания частоты и характеристик стула. Ведите дневник пищеварения, анализируйте статистику и делитесь результатами.">
    <meta name="keywords" content="трекер кала, дневник пищеварения, учет стула, здоровье кишечника, каклог, как лог">
    <style>
        :root {
            --primary-brown: #8B4513;
            --dark-brown: #654321;
            --light-brown: #A0522D;
            --cream: #F5DEB3;
            --glass-bg: rgba(139, 69, 19, 0.15);
            --glass-border: rgba(139, 69, 19, 0.2);
            --glass-shadow: rgba(0, 0, 0, 0.1);
            --text-dark: #3E2723;
            --text-light: #F5F5F5;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-brown) 0%, var(--primary-brown) 50%, var(--light-brown) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Стиль матового стекла */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px var(--glass-shadow);
            padding: 20px;
            transition: var(--transition);
        }

        /* Заголовок сайта */
        header {
            width: 100%;
            margin-bottom: 30px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--cream);
            background: var(--primary-brown);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--cream);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }

        .logo-subtitle {
            font-size: 1rem;
            color: var(--cream);
            opacity: 0.9;
            font-style: italic;
            margin-top: -5px;
        }

        /* Навигация */
        nav {
            width: 100%;
            margin-bottom: 30px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            list-style: none;
        }

        .nav-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 12px;
            background: var(--glass-bg);
            backdrop-filter: blur(5px);
            border: 1px solid var(--glass-border);
            color: var(--cream);
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(139, 69, 19, 0.3);
            transform: translateY(-3px);
        }

        .nav-tab.active {
            background: var(--primary-brown);
            color: var(--cream);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Основное содержимое */
        main {
            width: 100%;
            min-height: 500px;
            margin-bottom: 30px;
        }

        .page {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--cream);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title i {
            color: var(--primary-brown);
            background: var(--cream);
            padding: 8px;
            border-radius: 10px;
        }

        /* Карточки */
        .card {
            background: rgba(245, 222, 179, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--dark-brown);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Формы */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-brown);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid var(--light-brown);
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            color: var(--text-dark);
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-brown);
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.2);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Кнопки */
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-brown);
            color: var(--cream);
        }

        .btn-primary:hover {
            background: var(--dark-brown);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: var(--light-brown);
            color: var(--cream);
        }

        .btn-secondary:hover {
            background: var(--primary-brown);
            transform: translateY(-3px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Статистика */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(245, 222, 179, 0.9);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-brown);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--dark-brown);
            font-weight: 600;
        }

        /* Записи */
        .record {
            background: rgba(245, 222, 179, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--primary-brown);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .record-date {
            font-weight: 700;
            color: var(--dark-brown);
            font-size: 1.1rem;
        }

        .record-type {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--primary-brown);
            color: var(--cream);
        }

        .record-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .record-detail {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--light-brown);
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--dark-brown);
            font-weight: 500;
        }

        /* Поиск */
        .search-container {
            margin-bottom: 25px;
        }

        .search-box {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border-radius: 25px;
            border: 1px solid var(--light-brown);
            background: rgba(245, 222, 179, 0.9);
            font-size: 1rem;
            color: var(--text-dark);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-brown);
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-brown);
        }

        /* Настройки */
        .settings-group {
            margin-bottom: 30px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(245, 222, 179, 0.9);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-info h3 {
            color: var(--dark-brown);
            margin-bottom: 5px;
        }

        .setting-info p {
            color: var(--light-brown);
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 34px;
            transition: var(--transition);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-checkbox:checked + .toggle-slider {
            background-color: var(--primary-brown);
        }

        .toggle-checkbox:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Футер */
        footer {
            width: 100%;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
            color: var(--cream);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Уведомления */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: var(--primary-brown);
            color: var(--cream);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            max-width: 350px;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-tab {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .logo-text {
                font-size: 2.2rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .btn-group {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .logo-text {
                font-size: 1.8rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .record-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Шапка сайта -->
        <header class="glass">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-toilet-paper"></i>
                </div>
                <div>
                    <h1 class="logo-text">КАКЛОГ</h1>
                    <p class="logo-subtitle">Дневник пищеварения и учета стула</p>
                </div>
            </div>
        </header>

        <!-- Навигация -->
        <nav class="glass">
            <ul class="nav-tabs">
                <li class="nav-tab active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Главная</span>
                </li>
                <li class="nav-tab" data-page="add-record">
                    <i class="fas fa-plus-circle"></i>
                    <span>Добавить запись</span>
                </li>
                <li class="nav-tab" data-page="history">
                    <i class="fas fa-history"></i>
                    <span>История</span>
                </li>
                <li class="nav-tab" data-page="statistics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Статистика</span>
                </li>
                <li class="nav-tab" data-page="export">
                    <i class="fas fa-share-alt"></i>
                    <span>Экспорт</span>
                </li>
                <li class="nav-tab" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Настройки</span>
                </li>
            </ul>
        </nav>

        <!-- Основное содержимое -->
        <main class="glass">
            <!-- Главная страница -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-home"></i>
                        Обзор
                    </h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="quick-add-btn">
                            <i class="fas fa-plus"></i>
                            Быстрая запись
                        </button>
                    </div>
                </div>

                <div class="stats-container">
                    <div class="stat-card glass">
                        <div class="stat-value" id="today-count">0</div>
                        <div class="stat-label">Сегодня</div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-value" id="week-count">0</div>
                        <div class="stat-label">За неделю</div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-value" id="month-count">0</div>
                        <div class="stat-label">За месяц</div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">Всего записей</div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-info-circle"></i>
                        О приложении
                    </h3>
                    <p>Каклог — это приложение для отслеживания частоты и характеристик стула. Оно поможет вам:</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>Вести учет регулярности дефекации</li>
                        <li>Отслеживать изменения в пищеварении</li>
                        <li>Выявлять закономерности и триггеры</li>
                        <li>Делиться информацией с врачом при необходимости</li>
                    </ul>
                    <p style="margin-top: 15px;">Все данные хранятся локально в вашем браузере и не передаются на сервер.</p>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-fire"></i>
                        Последние записи
                    </h3>
                    <div id="recent-records">
                        <!-- Последние записи будут загружены через JS -->
                        <p style="text-align: center; color: var(--light-brown); padding: 20px;">
                            Записей пока нет. Добавьте первую запись!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Добавление записи -->
            <div id="add-record" class="page">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-plus-circle"></i>
                        Новая запись
                    </h2>
                </div>

                <div class="card">
                    <form id="record-form">
                        <div class="form-group">
                            <label class="form-label">Дата и время</label>
                            <input type="datetime-local" class="form-input" id="record-date" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Тип стула (по Бристольской шкале)</label>
                            <select class="form-select" id="stool-type" required>
                                <option value="">Выберите тип</option>
                                <option value="1">Тип 1: Отдельные твердые комки</option>
                                <option value="2">Тип 2: Колбасовидный, но комковатый</option>
                                <option value="3">Тип 3: Колбасовидный, с трещинами на поверхности</option>
                                <option value="4">Тип 4: Колбасовидный или змеевидный, гладкий и мягкий</option>
                                <option value="5">Тип 5: Мягкие комки с четкими краями</option>
                                <option value="6">Тип 6: Кашицеобразный, пушистый кусочками</option>
                                <option value="7">Тип 7: Водянистый, без твердых кусочков</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Цвет</label>
                            <select class="form-select" id="stool-color">
                                <option value="Коричневый">Коричневый (норма)</option>
                                <option value="Темно-коричневый">Темно-коричневый</option>
                                <option value="Светло-коричневый">Светло-коричневый</option>
                                <option value="Зеленый">Зеленый</option>
                                <option value="Желтый">Желтый</option>
                                <option value="Черный">Черный</option>
                                <option value="Красный">Красный</option>
                                <option value="Белый/Серый">Белый/Серый</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Консистенция</label>
                            <select class="form-select" id="stool-consistency">
                                <option value="Нормальная">Нормальная</option>
                                <option value="Твердая">Твердая</option>
                                <option value="Мягкая">Мягкая</option>
                                <option value="Водянистая">Водянистая</option>
                                <option value="Комковатая">Комковатая</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Заметки (опционально)</label>
                            <textarea class="form-textarea" id="record-notes" placeholder="Дополнительные заметки, симптомы, употребленная пища и т.д."></textarea>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Сохранить запись
                            </button>
                            <button type="button" class="btn btn-secondary" id="reset-form">
                                <i class="fas fa-redo"></i>
                                Очистить
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- История записей -->
            <div id="history" class="page">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-history"></i>
                        История записей
                    </h2>
                    <div class="search-container">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="search-input" placeholder="Поиск по дате, типу или заметкам...">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div id="records-list">
                        <!-- Записи будут загружены через JS -->
                        <p style="text-align: center; color: var(--light-brown); padding: 20px;">
                            Записей пока нет. Добавьте первую запись!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Статистика -->
            <div id="statistics" class="page">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        Статистика
                    </h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="refresh-stats">
                            <i class="fas fa-sync-alt"></i>
                            Обновить
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        Распределение по типам стула
                    </h3>
                    <div id="type-chart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--light-brown);">
                        <p>Данные для графика появятся после добавления записей</p>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Частота по дням (последние 30 дней)
                    </h3>
                    <div id="frequency-chart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--light-brown);">
                        <p>Данные для графика появятся после добавления записей</p>
                    </div>
                </div>
            </div>

            <!-- Экспорт и обмен -->
            <div id="export" class="page">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-share-alt"></i>
                        Экспорт и обмен
                    </h2>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-file-export"></i>
                        Экспорт данных
                    </h3>
                    <p>Вы можете экспортировать все ваши записи в файл для хранения или передачи врачу.</p>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="export-json">
                            <i class="fas fa-file-code"></i>
                            Экспорт в JSON
                        </button>
                        <button class="btn btn-success" id="export-txt">
                            <i class="fas fa-file-alt"></i>
                            Экспорт в TXT
                        </button>
                        <button class="btn btn-secondary" id="export-csv">
                            <i class="fas fa-file-csv"></i>
                            Экспорт в CSV
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-share"></i>
                        Поделиться статистикой
                    </h3>
                    <p>Создайте ссылку для общего доступа к вашей статистике (без личных заметок).</p>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Срок действия ссылки</label>
                        <select class="form-select" id="share-expiry">
                            <option value="1">1 день</option>
                            <option value="7" selected>1 неделя</option>
                            <option value="30">1 месяц</option>
                            <option value="365">1 год</option>
                        </select>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="generate-share">
                            <i class="fas fa-link"></i>
                            Создать ссылку
                        </button>
                    </div>
                    
                    <div id="share-link-container" style="margin-top: 20px; display: none;">
                        <label class="form-label">Ваша ссылка для общего доступа:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" id="share-link" readonly>
                            <button class="btn btn-secondary" id="copy-share">
                                <i class="fas fa-copy"></i>
                                Копировать
                            </button>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--light-brown); margin-top: 5px;">
                            Ссылка будет активна до: <span id="share-expiry-date"></span>
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-file-import"></i>
                        Импорт данных
                    </h3>
                    <p>Импортируйте ранее экспортированные данные (формат JSON).</p>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Файл JSON</label>
                        <input type="file" class="form-input" id="import-file" accept=".json">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="import-data">
                            <i class="fas fa-file-import"></i>
                            Импортировать
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 10px; display: none;" id="import-success">
                        <p style="color: var(--success);"><i class="fas fa-check-circle"></i> Данные успешно импортированы!</p>
                    </div>
                </div>
            </div>

            <!-- Настройки -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h2 class="page-title">
                        <i class="fas fa-cog"></i>
                        Настройки
                    </h2>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-bell"></i>
                        Уведомления
                    </h3>
                    
                    <div class="settings-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Напоминания о записи</h3>
                                <p>Регулярные напоминания вести учет</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" class="toggle-checkbox" id="reminders-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Ежедневный отчет</h3>
                                <p>Отправлять сводку за день</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" class="toggle-checkbox" id="daily-report-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-palette"></i>
                        Внешний вид
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Цветовая тема</label>
                        <select class="form-select" id="theme-select">
                            <option value="brown">Коричневая (стандартная)</option>
                            <option value="blue">Синяя</option>
                            <option value="green">Зеленая</option>
                            <option value="dark">Темная</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Единицы измерения</label>
                        <select class="form-select" id="units-select">
                            <option value="metric">Метрические</option>
                            <option value="imperial">Имперские</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-database"></i>
                        Управление данными
                    </h3>
                    
                    <p>Здесь вы можете управлять данными приложения.</p>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="backup-data">
                            <i class="fas fa-save"></i>
                            Создать резервную копию
                        </button>
                        <button class="btn btn-danger" id="clear-data">
                            <i class="fas fa-trash-alt"></i>
                            Удалить все данные
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(245, 222, 179, 0.5); border-radius: 10px;">
                        <p><strong>Использование хранилища:</strong> <span id="storage-usage">0 KB</span></p>
                        <div style="height: 10px; background: var(--cream); border-radius: 5px; margin-top: 10px; overflow: hidden;">
                            <div id="storage-bar" style="height: 100%; background: var(--primary-brown); width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Футер -->
        <footer class="glass">
            <p>Каклог &copy; 2026</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">
                <i class="fas fa-shield-alt"></i> Конфиденциальность гарантирована
            </p>
        </footer>
    </div>

    <!-- Уведомление -->
    <div id="notification" class="notification">
        <p id="notification-text">Сообщение</p>
    </div>

    <script>
        // Ключевые переменные приложения
        const STORAGE_KEY = 'kaklog_records';
        const SETTINGS_KEY = 'kaklog_settings';
        const SHARE_KEY_PREFIX = 'kaklog_share_';
        
        let records = [];
        let settings = {};
        let currentPage = 'dashboard';
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            loadRecords();
            loadSettings();
            initNavigation();
            initEventListeners();
            updateDashboard();
            updateHistory();
            updateStorageUsage();
            
            // Установка текущей даты и времени в форму
            const now = new Date();
            const timezoneOffset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
            document.getElementById('record-date').value = localISOTime;
        });
        
        // Загрузка записей из LocalStorage
        function loadRecords() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    records = JSON.parse(stored);
                } catch (e) {
                    console.error('Ошибка загрузки записей:', e);
                    records = [];
                }
            }
        }
        
        // Сохранение записей в LocalStorage
        function saveRecords() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            updateStorageUsage();
        }
        
        // Загрузка настроек из LocalStorage
        function loadSettings() {
            const stored = localStorage.getItem(SETTINGS_KEY);
            if (stored) {
                try {
                    settings = JSON.parse(stored);
                    applySettings();
                } catch (e) {
                    console.error('Ошибка загрузки настроек:', e);
                    settings = {};
                }
            } else {
                // Настройки по умолчанию
                settings = {
                    theme: 'brown',
                    units: 'metric',
                    reminders: false,
                    dailyReport: false
                };
                saveSettings();
            }
        }
        
        // Сохранение настроек в LocalStorage
        function saveSettings() {
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
            applySettings();
            updateStorageUsage();
        }
        
        // Применение настроек к интерфейсу
        function applySettings() {
            // Тема
            document.getElementById('theme-select').value = settings.theme || 'brown';
            
            // Единицы измерения
            document.getElementById('units-select').value = settings.units || 'metric';
            
            // Переключатели
            document.getElementById('reminders-toggle').checked = settings.reminders || false;
            document.getElementById('daily-report-toggle').checked = settings.dailyReport || false;
            
            // Применение цветовой темы
            applyTheme(settings.theme || 'brown');
        }
        
        // Применение цветовой темы
        function applyTheme(theme) {
            const root = document.documentElement;
            
            // Сброс к стандартным значениям
            root.style.setProperty('--primary-brown', '#8B4513');
            root.style.setProperty('--dark-brown', '#654321');
            root.style.setProperty('--light-brown', '#A0522D');
            root.style.setProperty('--cream', '#F5DEB3');
            root.style.setProperty('--glass-bg', 'rgba(139, 69, 19, 0.15)');
            root.style.setProperty('--glass-border', 'rgba(139, 69, 19, 0.2)');
            
            if (theme === 'blue') {
                root.style.setProperty('--primary-brown', '#1E3A8A');
                root.style.setProperty('--dark-brown', '#1E40AF');
                root.style.setProperty('--light-brown', '#3B82F6');
                root.style.setProperty('--cream', '#EFF6FF');
                root.style.setProperty('--glass-bg', 'rgba(30, 58, 138, 0.15)');
                root.style.setProperty('--glass-border', 'rgba(30, 58, 138, 0.2)');
            } else if (theme === 'green') {
                root.style.setProperty('--primary-brown', '#065F46');
                root.style.setProperty('--dark-brown', '#047857');
                root.style.setProperty('--light-brown', '#10B981');
                root.style.setProperty('--cream', '#ECFDF5');
                root.style.setProperty('--glass-bg', 'rgba(6, 95, 70, 0.15)');
                root.style.setProperty('--glass-border', 'rgba(6, 95, 70, 0.2)');
            } else if (theme === 'dark') {
                root.style.setProperty('--primary-brown', '#374151');
                root.style.setProperty('--dark-brown', '#1F2937');
                root.style.setProperty('--light-brown', '#6B7280');
                root.style.setProperty('--cream', '#F9FAFB');
                root.style.setProperty('--glass-bg', 'rgba(55, 65, 81, 0.15)');
                root.style.setProperty('--glass-border', 'rgba(55, 65, 81, 0.2)');
            }
        }
        
        // Инициализация навигации
        function initNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    switchPage(pageId);
                    
                    // Обновление активного состояния вкладок
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }
        
        // Переключение страниц
        function switchPage(pageId) {
            // Скрыть текущую страницу
            const currentPageElement = document.getElementById(currentPage);
            if (currentPageElement) {
                currentPageElement.classList.remove('active');
            }
            
            // Показать новую страницу
            const newPageElement = document.getElementById(pageId);
            if (newPageElement) {
                newPageElement.classList.add('active');
                currentPage = pageId;
                
                // Обновление данных на странице
                if (pageId === 'dashboard') {
                    updateDashboard();
                } else if (pageId === 'history') {
                    updateHistory();
                } else if (pageId === 'statistics') {
                    updateStatistics();
                }
            }
        }
        
        // Инициализация обработчиков событий
        function initEventListeners() {
            // Форма добавления записи
            document.getElementById('record-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addRecord();
            });
            
            // Сброс формы
            document.getElementById('reset-form').addEventListener('click', function() {
                document.getElementById('record-form').reset();
                const now = new Date();
                const timezoneOffset = now.getTimezoneOffset() * 60000;
                const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
                document.getElementById('record-date').value = localISOTime;
            });
            
            // Быстрое добавление записи
            document.getElementById('quick-add-btn').addEventListener('click', function() {
                switchPage('add-record');
            });
            
            // Поиск
            document.getElementById('search-input').addEventListener('input', function() {
                updateHistory();
            });
            
            // Обновление статистики
            document.getElementById('refresh-stats').addEventListener('click', function() {
                updateStatistics();
            });
            
            // Экспорт данных
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('export-txt').addEventListener('click', exportTXT);
            document.getElementById('export-csv').addEventListener('click', exportCSV);
            
            // Импорт данных
            document.getElementById('import-data').addEventListener('click', importData);
            
            // Создание ссылки для общего доступа
            document.getElementById('generate-share').addEventListener('click', generateShareLink);
            
            // Копирование ссылки
            document.getElementById('copy-share').addEventListener('click', copyShareLink);
            
            // Настройки темы
            document.getElementById('theme-select').addEventListener('change', function() {
                settings.theme = this.value;
                saveSettings();
            });
            
            // Настройки единиц измерения
            document.getElementById('units-select').addEventListener('change', function() {
                settings.units = this.value;
                saveSettings();
            });
            
            // Настройки уведомлений
            document.getElementById('reminders-toggle').addEventListener('change', function() {
                settings.reminders = this.checked;
                saveSettings();
            });
            
            document.getElementById('daily-report-toggle').addEventListener('change', function() {
                settings.dailyReport = this.checked;
                saveSettings();
            });
            
            // Резервное копирование
            document.getElementById('backup-data').addEventListener('click', backupData);
            
            // Удаление всех данных
            document.getElementById('clear-data').addEventListener('click', clearData);
        }
        
        // Добавление новой записи
        function addRecord() {
            const date = document.getElementById('record-date').value;
            const type = document.getElementById('stool-type').value;
            const color = document.getElementById('stool-color').value;
            const consistency = document.getElementById('stool-consistency').value;
            const notes = document.getElementById('record-notes').value;
            
            if (!date || !type) {
                showNotification('Пожалуйста, заполните обязательные поля', 'warning');
                return;
            }
            
            const record = {
                id: Date.now(),
                date: date,
                type: type,
                typeText: document.getElementById('stool-type').options[document.getElementById('stool-type').selectedIndex].text,
                color: color,
                consistency: consistency,
                notes: notes,
                timestamp: new Date().getTime()
            };
            
            records.unshift(record); // Добавляем в начало массива
            saveRecords();
            
            showNotification('Запись успешно добавлена!', 'success');
            document.getElementById('record-form').reset();
            
            // Установка текущей даты и времени
            const now = new Date();
            const timezoneOffset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
            document.getElementById('record-date').value = localISOTime;
            
            // Обновление дашборда
            updateDashboard();
            
            // Переход на главную страницу
            switchPage('dashboard');
        }
        
        // Обновление главной страницы
        function updateDashboard() {
            // Статистика
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStart = today.getTime();
            const todayEnd = todayStart + 24 * 60 * 60 * 1000;
            
            const todayCount = records.filter(r => {
                const recordDate = new Date(r.date).getTime();
                return recordDate >= todayStart && recordDate < todayEnd;
            }).length;
            
            const weekAgo = new Date(todayStart - 7 * 24 * 60 * 60 * 1000);
            const weekCount = records.filter(r => {
                const recordDate = new Date(r.date).getTime();
                return recordDate >= weekAgo.getTime();
            }).length;
            
            const monthAgo = new Date(todayStart - 30 * 24 * 60 * 60 * 1000);
            const monthCount = records.filter(r => {
                const recordDate = new Date(r.date).getTime();
                return recordDate >= monthAgo.getTime();
            }).length;
            
            document.getElementById('today-count').textContent = todayCount;
            document.getElementById('week-count').textContent = weekCount;
            document.getElementById('month-count').textContent = monthCount;
            document.getElementById('total-count').textContent = records.length;
            
            // Последние записи
            const recentRecordsContainer = document.getElementById('recent-records');
            if (records.length === 0) {
                recentRecordsContainer.innerHTML = '<p style="text-align: center; color: var(--light-brown); padding: 20px;">Записей пока нет. Добавьте первую запись!</p>';
                return;
            }
            
            const recentRecords = records.slice(0, 5);
            recentRecordsContainer.innerHTML = '';
            
            recentRecords.forEach(record => {
                const recordElement = createRecordElement(record);
                recentRecordsContainer.appendChild(recordElement);
            });
        }
        
        // Обновление истории
        function updateHistory() {
            const searchQuery = document.getElementById('search-input').value.toLowerCase();
            const recordsList = document.getElementById('records-list');
            
            if (records.length === 0) {
                recordsList.innerHTML = '<p style="text-align: center; color: var(--light-brown); padding: 20px;">Записей пока нет. Добавьте первую запись!</p>';
                return;
            }
            
            // Фильтрация записей
            let filteredRecords = records;
            if (searchQuery) {
                filteredRecords = records.filter(record => {
                    return (
                        record.date.toLowerCase().includes(searchQuery) ||
                        record.typeText.toLowerCase().includes(searchQuery) ||
                        record.color.toLowerCase().includes(searchQuery) ||
                        (record.notes && record.notes.toLowerCase().includes(searchQuery))
                    );
                });
            }
            
            if (filteredRecords.length === 0) {
                recordsList.innerHTML = '<p style="text-align: center; color: var(--light-brown); padding: 20px;">Записи не найдены</p>';
                return;
            }
            
            recordsList.innerHTML = '';
            filteredRecords.forEach(record => {
                const recordElement = createRecordElement(record, true);
                recordsList.appendChild(recordElement);
            });
        }
        
        // Создание элемента записи
        function createRecordElement(record, withDelete = false) {
            const recordDate = new Date(record.date);
            const formattedDate = recordDate.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const recordElement = document.createElement('div');
            recordElement.className = 'record';
            recordElement.innerHTML = `
                <div class="record-header">
                    <div class="record-date">${formattedDate}</div>
                    <div class="record-type">Тип ${record.type}</div>
                </div>
                <div class="record-details">
                    <div class="record-detail">
                        <span class="detail-label">Цвет</span>
                        <span class="detail-value">${record.color}</span>
                    </div>
                    <div class="record-detail">
                        <span class="detail-label">Консистенция</span>
                        <span class="detail-value">${record.consistency}</span>
                    </div>
                    ${record.notes ? `
                    <div class="record-detail">
                        <span class="detail-label">Заметки</span>
                        <span class="detail-value">${record.notes}</span>
                    </div>
                    ` : ''}
                </div>
                ${withDelete ? `
                <div style="margin-top: 15px; text-align: right;">
                    <button class="btn btn-danger btn-sm delete-record" data-id="${record.id}">
                        <i class="fas fa-trash"></i> Удалить
                    </button>
                </div>
                ` : ''}
            `;
            
            // Добавление обработчика удаления
            if (withDelete) {
                const deleteBtn = recordElement.querySelector('.delete-record');
                deleteBtn.addEventListener('click', function() {
                    if (confirm('Вы уверены, что хотите удалить эту запись?')) {
                        deleteRecord(record.id);
                    }
                });
            }
            
            return recordElement;
        }
        
        // Удаление записи
        function deleteRecord(id) {
            records = records.filter(record => record.id !== id);
            saveRecords();
            updateDashboard();
            updateHistory();
            showNotification('Запись удалена', 'success');
        }
        
        // Обновление статистики
        function updateStatistics() {
            // Простая текстовая статистика (в реальном приложении можно использовать библиотеку для графиков)
            const typeChart = document.getElementById('type-chart');
            const frequencyChart = document.getElementById('frequency-chart');
            
            if (records.length === 0) {
                typeChart.innerHTML = '<p>Данные для графика появятся после добавления записей</p>';
                frequencyChart.innerHTML = '<p>Данные для графика появятся после добавления записей</p>';
                return;
            }
            
            // Распределение по типам
            const typeCount = {};
            records.forEach(record => {
                typeCount[record.type] = (typeCount[record.type] || 0) + 1;
            });
            
            let typeChartHTML = '<div style="width: 100%;">';
            Object.keys(typeCount).sort().forEach(type => {
                const count = typeCount[type];
                const percentage = (count / records.length * 100).toFixed(1);
                
                typeChartHTML += `
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Тип ${type}:</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                    <div style="height: 10px; background: var(--cream); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; background: var(--primary-brown); width: ${percentage}%;"></div>
                    </div>
                </div>
                `;
            });
            typeChartHTML += '</div>';
            typeChart.innerHTML = typeChartHTML;
            
            // Частота по дням (последние 30 дней)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const dayCounts = {};
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
                dayCounts[dateString] = 0;
            }
            
            records.forEach(record => {
                const recordDate = new Date(record.date);
                recordDate.setHours(0, 0, 0, 0);
                
                const diffTime = today - recordDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays >= 0 && diffDays < 30) {
                    const dateString = recordDate.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
                    dayCounts[dateString] = (dayCounts[dateString] || 0) + 1;
                }
            });
            
            const maxCount = Math.max(...Object.values(dayCounts));
            
            let frequencyChartHTML = '<div style="display: flex; align-items: flex-end; height: 100%; gap: 3px;">';
            Object.keys(dayCounts).forEach(date => {
                const count = dayCounts[date];
                const height = maxCount > 0 ? (count / maxCount * 100) : 0;
                
                frequencyChartHTML += `
                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                    <div style="width: 100%; height: ${height}%; background: var(--primary-brown); border-radius: 3px 3px 0 0;"></div>
                    <div style="font-size: 0.7rem; margin-top: 5px; transform: rotate(-45deg); white-space: nowrap;">${date}</div>
                </div>
                `;
            });
            frequencyChartHTML += '</div>';
            frequencyChart.innerHTML = frequencyChartHTML;
        }
        
        // Экспорт в JSON
        function exportJSON() {
            const data = {
                records: records,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `kaklog_export_${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Данные экспортированы в JSON', 'success');
        }
        
        // Экспорт в TXT
        function exportTXT() {
            let txtContent = 'КАКЛОГ - Экспорт данных\n';
            txtContent += `Дата экспорта: ${new Date().toLocaleDateString('ru-RU')}\n`;
            txtContent += `Всего записей: ${records.length}\n\n`;
            
            txtContent += 'ЗАПИСИ:\n';
            txtContent += '='.repeat(50) + '\n\n';
            
            records.forEach((record, index) => {
                const recordDate = new Date(record.date);
                const formattedDate = recordDate.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                txtContent += `Запись ${index + 1}:\n`;
                txtContent += `  Дата: ${formattedDate}\n`;
                txtContent += `  Тип: ${record.typeText}\n`;
                txtContent += `  Цвет: ${record.color}\n`;
                txtContent += `  Консистенция: ${record.consistency}\n`;
                if (record.notes) {
                    txtContent += `  Заметки: ${record.notes}\n`;
                }
                txtContent += '\n' + '-'.repeat(30) + '\n\n';
            });
            
            const dataUri = 'data:text/plain;charset=utf-8,'+ encodeURIComponent(txtContent);
            const exportFileDefaultName = `kaklog_export_${new Date().toISOString().slice(0, 10)}.txt`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Данные экспортированы в TXT', 'success');
        }
        
        // Экспорт в CSV
        function exportCSV() {
            let csvContent = 'Дата,Тип,Тип (текст),Цвет,Консистенция,Заметки\n';
            
            records.forEach(record => {
                const recordDate = new Date(record.date);
                const formattedDate = recordDate.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const row = [
                    `"${formattedDate}"`,
                    `"${record.type}"`,
                    `"${record.typeText}"`,
                    `"${record.color}"`,
                    `"${record.consistency}"`,
                    `"${record.notes || ''}"`
                ].join(',');
                
                csvContent += row + '\n';
            });
            
            const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csvContent);
            const exportFileDefaultName = `kaklog_export_${new Date().toISOString().slice(0, 10)}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Данные экспортированы в CSV', 'success');
        }
        
        // Импорт данных
        function importData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Пожалуйста, выберите файл', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.records || !Array.isArray(data.records)) {
                        showNotification('Неверный формат файла', 'danger');
                        return;
                    }
                    
                    // Добавляем импортированные записи
                    data.records.forEach(record => {
                        // Генерируем новый ID для избежания конфликтов
                        record.id = Date.now() + Math.floor(Math.random() * 1000);
                        records.unshift(record);
                    });
                    
                    saveRecords();
                    
                    // Показать сообщение об успехе
                    const successEl = document.getElementById('import-success');
                    successEl.style.display = 'block';
                    setTimeout(() => {
                        successEl.style.display = 'none';
                    }, 3000);
                    
                    // Сброс выбора файла
                    fileInput.value = '';
                    
                    // Обновление интерфейса
                    updateDashboard();
                    updateHistory();
                    
                    showNotification(`Импортировано ${data.records.length} записей`, 'success');
                } catch (error) {
                    console.error('Ошибка импорта:', error);
                    showNotification('Ошибка при импорте файла', 'danger');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Создание ссылки для общего доступа
        function generateShareLink() {
            const expiryDays = parseInt(document.getElementById('share-expiry').value);
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + expiryDays);
            
            // Создаем объект с общими данными (без личных заметок)
            const shareData = {
                statistics: {
                    total: records.length,
                    last30Days: records.filter(r => {
                        const recordDate = new Date(r.date);
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        return recordDate >= thirtyDaysAgo;
                    }).length,
                    typeDistribution: {}
                },
                exportDate: new Date().toISOString(),
                expiryDate: expiryDate.toISOString()
            };
            
            // Распределение по типам
            const typeCount = {};
            records.forEach(record => {
                typeCount[record.type] = (typeCount[record.type] || 0) + 1;
            });
            shareData.statistics.typeDistribution = typeCount;
            
            // Генерируем уникальный ключ
            const shareKey = 'share_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Сохраняем в LocalStorage
            localStorage.setItem(SHARE_KEY_PREFIX + shareKey, JSON.stringify(shareData));
            
            // Генерируем ссылку (в реальном приложении это был бы URL сервера)
            const shareLink = `${window.location.origin}${window.location.pathname}?share=${shareKey}`;
            
            // Показываем ссылку
            document.getElementById('share-link').value = shareLink;
            document.getElementById('share-expiry-date').textContent = expiryDate.toLocaleDateString('ru-RU');
            document.getElementById('share-link-container').style.display = 'block';
            
            showNotification('Ссылка для общего доступа создана', 'success');
        }
        
        // Копирование ссылки для общего доступа
        function copyShareLink() {
            const shareLinkInput = document.getElementById('share-link');
            shareLinkInput.select();
            shareLinkInput.setSelectionRange(0, 99999); // Для мобильных устройств
            
            try {
                document.execCommand('copy');
                showNotification('Ссылка скопирована в буфер обмена', 'success');
            } catch (err) {
                console.error('Ошибка копирования:', err);
                showNotification('Не удалось скопировать ссылку', 'danger');
            }
        }
        
        // Резервное копирование данных
        function backupData() {
            const data = {
                records: records,
                settings: settings,
                backupDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `kaklog_backup_${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Резервная копия создана', 'success');
        }
        
        // Очистка всех данных
        function clearData() {
            if (confirm('Вы уверены, что хотите удалить ВСЕ данные? Это действие нельзя отменить.')) {
                localStorage.removeItem(STORAGE_KEY);
                records = [];
                updateDashboard();
                updateHistory();
                showNotification('Все данные удалены', 'success');
            }
        }
        
        // Обновление информации об использовании хранилища
        function updateStorageUsage() {
            let totalSize = 0;
            
            // Размер записей
            const recordsSize = JSON.stringify(records).length;
            totalSize += recordsSize;
            
            // Размер настроек
            const settingsSize = JSON.stringify(settings).length;
            totalSize += settingsSize;
            
            // Размер общих ссылок
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(SHARE_KEY_PREFIX)) {
                    totalSize += localStorage.getItem(key).length;
                }
            }
            
            // Конвертация в читаемый формат
            let sizeText;
            if (totalSize < 1024) {
                sizeText = `${totalSize} B`;
            } else if (totalSize < 1024 * 1024) {
                sizeText = `${(totalSize / 1024).toFixed(2)} KB`;
            } else {
                sizeText = `${(totalSize / (1024 * 1024)).toFixed(2)} MB`;
            }
            
            document.getElementById('storage-usage').textContent = sizeText;
            
            // Прогресс бар (предполагаем лимит 5MB для LocalStorage)
            const maxStorage = 5 * 1024 * 1024; // 5MB
            const percentage = Math.min((totalSize / maxStorage) * 100, 100);
            document.getElementById('storage-bar').style.width = `${percentage}%`;
        }
        
        // Показать уведомление
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            // Установка цвета в зависимости от типа
            if (type === 'success') {
                notification.style.background = 'var(--success)';
            } else if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else if (type === 'danger') {
                notification.style.background = 'var(--danger)';
            } else {
                notification.style.background = 'var(--primary-brown)';
            }
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            // Автоматическое скрытие
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Функция для проверки общих ссылок при загрузке
        function checkForShareLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareKey = urlParams.get('share');
            
            if (shareKey) {
                const shareData = localStorage.getItem(SHARE_KEY_PREFIX + shareKey);
                
                if (shareData) {
                    try {
                        const data = JSON.parse(shareData);
                        const expiryDate = new Date(data.expiryDate);
                        
                        if (expiryDate > new Date()) {
                            // Показываем общие данные
                            alert(`Общая статистика:\nВсего записей: ${data.statistics.total}\nЗа последние 30 дней: ${data.statistics.last30Days}`);
                        } else {
                            // Ссылка истекла
                            alert('Ссылка для общего доступа истекла');
                        }
                    } catch (e) {
                        console.error('Ошибка загрузки общих данных:', e);
                    }
                }
                
                // Убираем параметр из URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }
        
        // Проверяем общие ссылки при загрузке
        checkForShareLink();
    </script>
</body>
</html>
